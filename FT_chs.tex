\documentclass[hyperref,UTF8,a4paper,openany]{ctexbook}
%\usepackage{ctex}
\usepackage{zhnumber}
\usepackage{graphicx}
\usepackage{subfigure}

\usepackage{latexsym}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{mathrsfs}
\usepackage{amsthm}
\usepackage{siunitx}

\usepackage{cases}

\usepackage{multirow}
\usepackage{bigstrut}
\usepackage{textcomp}
\usepackage[top=2.54cm, bottom=2.54cm, left=3.18cm, right=3.18cm]{geometry}
\usepackage[toc,lof]{multitoc}
%\usepackage[titletoc]{appendix}

\usepackage{asymptote}

%\usepackage{breqn}

\usepackage{hyperref}
\hypersetup{colorlinks,
        linkcolor=black,
        filecolor=black,
        urlcolor=blue,
        citecolor=black,
        pdftitle={郎道《场论》笔记},
        pdfauthor={张大鹏},
        pdfsubject={相对论力学, 电动力学, 广义相对论},
        pdfkeywords={相对论力学, 电动力学, 广义相对论},
        pdfproducer={XeLaTeX},
		pdfborder=0 0 1}

\setcounter{secnumdepth}{3} %使subsubsection也有编号

\usepackage{fancyhdr}	%页眉页脚

\usepackage{enumitem}
\setlist[enumerate,1]{leftmargin=0pt,itemindent=2em,itemsep=0ex,listparindent=2em,parsep = 0ex,topsep = 1ex}
\setlist[enumerate,2]{leftmargin=0pt,itemsep=0ex,listparindent=2em,parsep = 0ex,topsep = 1ex}
\setlist[enumerate,3]{leftmargin=0pt,itemsep=0ex,listparindent=2em,parsep = 0ex,topsep = 1ex}
\setlist[itemize,1]{itemsep = 0ex, parsep = 0ex, topsep = 1ex}
\setlist[description]{listparindent=2em, itemsep=0ex, parsep = 0ex,topsep = 1ex}

\ctexset{
	figurename={\kaishu 图},
	tablename={表},
	contentsname={目\quad 录},
	listfigurename={插图目录}
}

\newcommand{\ds}{\displaystyle}
\newcommand{\const}{\text{const}}
\newcommand{\eps}{\varepsilon}
\newcommand{\mbf}{\boldsymbol}
\newcommand{\mrm}[1]{\boldsymbol{\mathnormal{#1}}}
\newcommand{\bnb}{\mbf{\nabla}}
\newcommand{\pl}{\partial}
\newcommand{\arsinh}{\mathrm{arsinh}\,}
\newcommand{\arcosh}{\mathrm{arcosh}\,}
\newcommand{\sn}{\mathrm{sn}\,}
\newcommand{\cn}{\mathrm{cn}\,}
\newcommand{\tn}{\mathrm{tn}\,}
\newcommand{\dn}{\mathrm{dn}\,}
\newcommand{\am}{\mathrm{am}\,}
\newcommand{\mathd}{\mathrm{d}}
\newcommand{\mathe}{\mathrm{e}}
\newcommand{\mathi}{\mathrm{i}}
\newcommand{\E}{\mathscr{E}}
%\renewcommand{\H}{\mathscr{H}}
\renewcommand{\Re}{\mathrm{Re}\,}
\renewcommand{\Im}{\mathrm{Im}\,}
\renewcommand{\bf}{\heiti}
\renewcommand{\bfseries}{\heiti}

\newtheoremstyle{theoremwithoutdot}% 类型名
  {}%                   Space above, empty = `usual value'
  {}%                   Space below
  {\kaishu}%                   Body font
  {}%         Indent amount (empty = no indent, \parindent = para indent)
  {\heiti}%          Thm head font
  {}%                   Punctuation after thm head
  {1em}%                Space after thm head
  {\thmname{#1}\thmnumber{~#2}\thmnote{~(#3)}}%                   Thm head spec
  
 \newtheoremstyle{solutionstyle}% 类型名
  {}%                   Space above, empty = `usual value'
  {}%                   Space below
  {}%                   Body font
  {}%         Indent amount (empty = no indent, \parindent = para indent)
  {\heiti}%          Thm head font
  {}%                   Punctuation after thm head
  {1em}%                Space after thm head
  {\thmname{#1}\thmnumber{~#2}\thmnote{~(#3)}}%                   Thm head spec

\theoremstyle{theoremwithoutdot}
\newtheorem{defi}{定义}[section]
\newtheorem{theorem}{定理}[section]
\newtheorem{lemma}[theorem]{引理}
\newtheorem{prop}[theorem]{命题}
\newtheorem{coro}{推论}[theorem]
\newtheorem{remark}{注}
\newtheorem{example}{例}[chapter]
\newtheorem{question}{题}[section]
\newtheorem{property}[theorem]{性质}
%\renewcommand{\thequestion}{\arabic{chapter}.\arabic{section}.\arabic{question}}
\theoremstyle{solutionstyle}
\newtheorem*{solution}{解}
%去掉证明后面的点
\makeatletter
\renewenvironment{proof}[1][\proofname]{\par%
\pushQED{\qed}%
\normalfont \topsep6\p@\@plus6\p@\relax%
\trivlist%
\item[\hskip\labelsep%
#1]\ignorespaces%
}{%
\popQED\endtrivlist\@endpefalse%
}
\makeatother
\renewcommand{\proofname}{{\heiti 证明}}

%\renewcommand{\thefootnote}{\fnsymbol{footnote}}
%带圈脚注
\usepackage{pifont}
\usepackage[perpage,stable]{footmisc}  %每页脚注重新编号
\renewcommand{\thefootnote}{\ding{\numexpr191+\value{footnote}}}
% 脚注中的脚注序号不用上标，正文中的脚注号保持不变
\makeatletter
\def\my@makefnmark{\hbox{\normalfont\@thefnmark\space}}
\let\my@save@makefntext\@makefntext
\long\def\@makefntext#1{{%
  \let\@makefnmark\my@makefnmark
  \my@save@makefntext{#1}}}

\allowdisplaybreaks[3]

\title{《场论》笔记}
\author{张大鹏}
%\date{}

\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
\hbox{}
\vspace*{\fill}

\vspace{\fill}
\thispagestyle{empty}
\newpage
\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother

%在插图目录图编号前加上“图”
%\usepackage{titletoc}
%\titlecontents{figure}[0.5cm]{\songti}{\figurename~\thecontentslabel\quad}{\hspace*{-1.5cm}}{\titlerule*[0.12cm]{.}\contentspage}[\addvspace{6pt}]

%新的样式
\usepackage{titlesec}
\usepackage{xcolor,colortbl}
\usepackage{tgpagella}
\usepackage[T1]{fontenc}

\definecolor{titlecolor}{RGB}{129,129,188}
\definecolor{contentcolor}{RGB}{129,188,129}
\definecolor{backcolor}{RGB}{129,188,129}
%\definecolor{backcolor}{RGB}{26,162,83}
%\definecolor{backcolor}{RGB}{125,255,233}
\newcommand{\hwyk}{\heiti}
 
\newcommand{\mytitle}[1]{
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
\cellcolor{black} &\cellcolor{titlecolor} \textcolor{white}
{\newline\hwyk\LARGE 第\zhnumber{\thechapter}章 \  \ #1}
\end{tabular}
\arrayrulewidth=0.4pt
}
 
\newcommand{\mycont}[1]{
\vspace{-0.5cm}
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
\cellcolor{black} &\cellcolor{contentcolor} \textcolor{white}
{\newline\hwyk\LARGE #1}
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-1.5cm}
}
 
\newcommand{\mysection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{titlecolor}
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
\hline
\cellcolor{titlecolor} &  \textcolor{black}{\hwyk\LARGE \thesection ~ #1}
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.7cm}
}

\newcommand{\mysubsection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{titlecolor}
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
\hline
\cellcolor{titlecolor} &  \textcolor{black}{\hwyk\Large \thesubsection ~ #1} \\
\hline
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.5cm}
}

\newcommand{\mysubsubsection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{titlecolor}
\begin{tabular}{p{0.01\textwidth}p{0.95\textwidth}p{0.01\textwidth}}
\hline
\cellcolor{titlecolor} &  \textcolor{black}{\hwyk\Large \thesubsubsection ~ #1} & \cellcolor{titlecolor} \\
\hline
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.5cm}
}

\newcommand{\myappendix}[1]{
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
\cellcolor{black} &\cellcolor{backcolor} \textcolor{white}
{\newline\hwyk\LARGE 附录\thechapter \  \ #1}%\Alph{\thechapter}
\end{tabular}
\arrayrulewidth=0.4pt
}

 
\newcommand{\appendixsection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{backcolor}
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
\hline
\cellcolor{backcolor} &  \textcolor{black}{\hwyk\LARGE \thesection ~ #1}
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.7cm}
}

\newcommand{\appendixsubsection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{backcolor}
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
\hline
\cellcolor{backcolor} &  \textcolor{black}{\hwyk\Large \thesubsection ~ #1} \\
\hline
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.5cm}
}

\newcommand{\appendixsubsubsection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{backcolor}
\begin{tabular}{p{0.01\textwidth}p{0.95\textwidth}p{0.01\textwidth}}
\hline
\cellcolor{backcolor} &  \textcolor{black}{\hwyk\Large \thesubsubsection ~ #1} & \cellcolor{backcolor} \\
\hline
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.5cm}
}

\newcommand{\mybackmatter}[1]{
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
\cellcolor{black} &\cellcolor{backcolor} \textcolor{white}
{\newline\hwyk\LARGE #1}
\end{tabular}
\arrayrulewidth=0.4pt
}

\DeclareSIUnit{\statC}{statC}

\begin{document}

\begin{asydef}
	texpreamble("\usepackage[nosetpagesize]{color,graphicx}"); 
	texpreamble("\usepackage{xeCJK}");
	texpreamble("\setCJKmainfont{SimSun}");
	usepackage("amsmath");
	import graph;
\end{asydef}

\maketitle

\frontmatter

\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{第\zhnumber{\thechapter}章\ \ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ \ \rm #1}{}}	%这两个命令第一次必须出现在\pagestyle{fancy}之后，否则\pagestyle{fancy}会覆盖掉其效果
\markboth{\leftmark}{\rightmark}
\fancyhf{}
\fancyhead[CO]{\rightmark}
\fancyhead[LE,RO]{$\cdot$\, \thepage\, $\cdot$}
\fancyhead[CE]{\leftmark}
\renewcommand{\headrulewidth}{0.4pt}

\titleformat{\chapter}[hang]{\hwyk\LARGE}
{}{0mm}{\hspace{-0.4cm}\mycont}

\tableofcontents

\clearpage

\mainmatter

\titleformat{\chapter}[hang]{\hwyk\LARGE}
{}{0mm}{\hspace{-0.4cm}\mytitle}
 
\titleformat{\section}[hang]{\hwyk\LARGE}
{}{0mm}{\hspace{-0.5cm}\mysection}

\titleformat{\subsection}[hang]{\hwyk\large}
{}{0mm}{\hspace{-0.5cm}\mysubsection}

\titleformat{\subsubsection}[hang]{\hwyk\large}
{}{0mm}{\hspace{-0.5cm}\mysubsubsection}
 
\titlespacing{\chapter}
{0pc}{1.5ex plus .1ex minus .2ex}{.2pc}

\input{chapter/chapter1.tex}
\input{chapter/chapter2.tex}
\input{chapter/chapter3.tex}
\input{chapter/chapter4.tex}
\input{chapter/chapter5.tex}
\input{chapter/chapter6.tex}
\input{chapter/chapter7.tex}
\input{chapter/chapter8.tex}
\input{chapter/chapter9.tex}
\input{chapter/chapter10.tex}
\input{chapter/chapter11.tex}
\input{chapter/chapter12.tex}
\input{chapter/chapter13.tex}
\input{chapter/chapter14.tex}

\input{chapter/appendixA.tex}

\backmatter

\titleformat{\chapter}[hang]{\hwyk\LARGE}
{}{0mm}{\hspace{-0.4cm}\mybackmatter}

\addcontentsline{toc}{chapter}{\listfigurename}{%
\let\oldnumberline\numberline%
\renewcommand{\numberline}{\figurename~\oldnumberline}%
\listoffigures
}

%参考文献
\input{chapter/bibliography.tex}

\end{document}
